#include <stdio.h>
#include <string.h>

struct File {
    char fname[20];
};

struct User {
    char uname[20];
    struct File file[10];
    int fcount;
};

int main() {
    struct User user[10];
    int ucount = 0;
    int choice, i, j;
    char uname[20], fname[20];
    int foundUser, foundFile;

    printf("\n--- TWO LEVEL DIRECTORY STRUCTURE ---\n");

    while (1) {
        printf("\n1. Create User Directory");
        printf("\n2. Create File in User Directory");
        printf("\n3. Search File in User Directory");
        printf("\n4. Display Files of User");
        printf("\n5. Exit");
        printf("\nEnter your choice (1-5): ");
        scanf("%d", &choice);

        if (choice < 1 || choice > 5) {
            printf("Invalid option! Please choose between 1-5 only.\n");
            continue;
        }

        if (choice == 1) {
            if (ucount == 10) {
                printf("Maximum user directories created!\n");
                continue;
            }

            printf("Enter new user name: ");
            scanf("%s", uname);

            for (i = 0; i < ucount; i++) {
                if (strcmp(uname, user[i].uname) == 0) {
                    printf("User directory already exists!\n");
                    goto endCreateUser;
                }
            }

            strcpy(user[ucount].uname, uname);
            user[ucount].fcount = 0;
            ucount++;

            printf("User directory created successfully.\n");

        endCreateUser:
            continue;
        }

        if (choice == 2) {
            printf("Enter user name: ");
            scanf("%s", uname);

            foundUser = -1;
            for (i = 0; i < ucount; i++) {
                if (strcmp(uname, user[i].uname) == 0) {
                    foundUser = i;
                    break;
                }
            }

            if (foundUser == -1) {
                printf("User directory not found!\n");
                continue;
            }

            if (user[foundUser].fcount == 10) {
                printf("File limit reached for this user!\n");
                continue;
            }

            printf("Enter file name to create: ");
            scanf("%s", fname);

            for (j = 0; j < user[foundUser].fcount; j++) {
                if (strcmp(fname, user[foundUser].file[j].fname) == 0) {
                    printf("File already exists!\n");
                    goto endCreateFile;
                }
            }

            strcpy(user[foundUser].file[user[foundUser].fcount].fname, fname);
            user[foundUser].fcount++;

            printf("File created successfully.\n");

        endCreateFile:
            continue;
        }

        if (choice == 3) {
            printf("Enter user name: ");
            scanf("%s", uname);

            foundUser = -1;
            for (i = 0; i < ucount; i++) {
                if (strcmp(uname, user[i].uname) == 0) {
                    foundUser = i;
                    break;
                }
            }

            if (foundUser == -1) {
                printf("User directory not found!\n");
                continue;
            }

            printf("Enter file name to search: ");
            scanf("%s", fname);

            foundFile = 0;
            for (j = 0; j < user[foundUser].fcount; j++) {
                if (strcmp(fname, user[foundUser].file[j].fname) == 0) {
                    foundFile = 1;
                    break;
                }
            }

            if (foundFile)
                printf("File found.\n");
            else
                printf("File not found.\n");

            continue;
        }

        if (choice == 4) {
            printf("Enter user name: ");
            scanf("%s", uname);

            foundUser = -1;
            for (i = 0; i < ucount; i++) {
                if (strcmp(uname, user[i].uname) == 0) {
                    foundUser = i;
                    break;
                }
            }

            if (foundUser == -1) {
                printf("User directory not found!\n");
                continue;
            }

            if (user[foundUser].fcount == 0) {
                printf("No files in this directory.\n");
            } else {
                printf("\nFiles under %s:\n", uname);
                for (j = 0; j < user[foundUser].fcount; j++) {
                    printf("%s\n", user[foundUser].file[j].fname);
                }
            }

            continue;
        }

        if (choice == 5) {
            printf("Exiting program.\n");
            break;
        }
    }

    return 0;
}